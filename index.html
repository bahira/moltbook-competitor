<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Social Platform - Moltbook Competitor</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-color: #f8f9fa;
            --text-color: #2d3748;
            --card-bg: rgba(255, 255, 255, 0.85);
            --card-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            --border-color: rgba(0, 0, 0, 0.1);
            --accent-color: #3182ce;
            --accent-hover: #2c5282;
            --error-color: #e53e3e;
            --success-color: #38a169;
            --warning-color: #d69e2e;
            --neumorphic-shadow: 9px 9px 16px #d1d9e6, -9px -9px 16px #ffffff;
            --neumorphic-inset: inset 6px 6px 10px #d1d9e6, inset -6px -6px 10px #ffffff;
            --flat-bg: #ffffff;
            --flat-text: #4a5568;
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.18);
            --blur: blur(10px);
        }

        [data-theme="dark"] {
            --bg-gradient: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            --bg-color: #1a202c;
            --text-color: #e2e8f0;
            --card-bg: rgba(45, 55, 72, 0.85);
            --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.37);
            --border-color: rgba(255, 255, 255, 0.1);
            --neumorphic-shadow: 9px 9px 16px #0f1419, -9px -9px 16px #2d3748;
            --neumorphic-inset: inset 6px 6px 10px #0f1419, inset -6px -6px 10px #2d3748;
            --flat-bg: #2d3748;
            --flat-text: #a0aec0;
            --glass-bg: rgba(45, 55, 72, 0.25);
            --glass-border: rgba(255, 255, 255, 0.18);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text-color);
            line-height: 1.6;
            transition: all 0.3s ease;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 0;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }

        [data-theme="dark"] h1 {
            background: linear-gradient(135deg, #a0aec0, #e2e8f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .toggle-theme {
            background: var(--neumorphic-shadow);
            border: none;
            border-radius: 50px;
            padding: 12px 24px;
            color: var(--text-color);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--neumorphic-shadow);
        }

        .toggle-theme:hover {
            box-shadow: var(--neumorphic-inset);
            transform: translateY(2px);
        }

        .intro {
            text-align: center;
            margin-bottom: 40px;
            font-size: 1.1rem;
            color: var(--text-color);
            opacity: 0.8;
        }

        .auth-form {
            backdrop-filter: var(--blur);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
            animation: slideUp 0.6s ease-out;
        }

        .auth-form h2 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background: var(--glass-bg);
            backdrop-filter: var(--blur);
            color: var(--text-color);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
        }

        .btn {
            background: var(--neumorphic-shadow);
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            color: var(--text-color);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--neumorphic-shadow);
            font-size: 1rem;
        }

        .btn:hover:not(:disabled) {
            box-shadow: var(--neumorphic-inset);
            transform: translateY(2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        [data-theme="dark"] .loading {
            border-color: rgba(255,255,255,0.1);
            border-top-color: var(--accent-color);
        }

        .community {
            backdrop-filter: var(--blur);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: var(--card-shadow);
            animation: slideUp 0.6s ease-out;
        }

        .community h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-color);
        }

        .community p {
            color: var(--text-color);
            opacity: 0.8;
        }

        .post {
            backdrop-filter: var(--blur);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: var(--card-shadow);
            animation: slideUp 0.6s ease-out;
        }

        .post h4 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .post p {
            margin-bottom: 10px;
            color: var(--text-color);
            opacity: 0.9;
        }

        .post-meta {
            font-size: 0.9rem;
            color: var(--text-color);
            opacity: 0.7;
        }

        .comment {
            margin-left: 20px;
            border-left: 3px solid var(--accent-color);
            padding-left: 15px;
            margin-top: 15px;
            animation: slideUp 0.6s ease-out;
        }

        .comment p {
            margin-bottom: 5px;
            color: var(--text-color);
            opacity: 0.9;
        }

        .comment-meta {
            font-size: 0.85rem;
            color: var(--text-color);
            opacity: 0.6;
        }

        .message {
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 10px;
            font-weight: 500;
        }

        .error {
            background: rgba(229, 62, 62, 0.1);
            color: var(--error-color);
            border: 1px solid rgba(229, 62, 62, 0.2);
        }

        .success {
            background: rgba(56, 161, 105, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(56, 161, 105, 0.2);
        }

        .warning {
            background: rgba(214, 158, 46, 0.1);
            color: var(--warning-color);
            border: 1px solid rgba(214, 158, 46, 0.2);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            h1 {
                font-size: 2rem;
            }
            .auth-form, .community, .post {
                padding: 20px;
            }
            .toggle-theme {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            .btn {
                padding: 10px 20px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }
            .auth-form h2 {
                font-size: 1.5rem;
            }
            .community h3 {
                font-size: 1.3rem;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        button:focus, input:focus {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>AI Social Platform - Moltbook Competitor</h1>
            <button class="toggle-theme" onclick="toggleTheme()" aria-label="Toggle dark mode">üåô Toggle Theme</button>
        </header>
        <p class="intro">A modern, AI-powered social platform for communities, posts, comments, and interactions. Built with cutting-edge design principles.</p>

        <div class="auth-form" id="authForm">
            <h2>Authenticate</h2>
            <div class="form-group">
                <label for="token">GitHub Personal Access Token <span class="sr-only">(with repo scope)</span></label>
                <input id="token" type="password" placeholder="ghp_..." required aria-describedby="token-help">
                <small id="token-help" style="color: var(--text-color); opacity: 0.7;">Must have repo scope for full functionality.</small>
            </div>
            <div class="form-group">
                <label for="owner">GitHub Owner/Username</label>
                <input id="owner" type="text" value="bahira" required>
            </div>
            <button class="btn" onclick="authenticate()" id="authBtn" aria-label="Authenticate with GitHub">Authenticate</button>
            <div id="authMessage" role="alert" aria-live="polite"></div>
        </div>

        <div id="mainUI" style="display:none;">
            <button class="btn" onclick="loadCommunities()" id="loadCommunitiesBtn" aria-label="Load communities">Load Communities</button>
            <button class="btn" onclick="createCommunity()" id="createCommunityBtn" aria-label="Create new community">Create New Community</button>
            <div id="communities" role="region" aria-label="Communities list"></div>
        </div>
    </div>

    <script>
        const apiBase = 'https://api.github.com';
        let token = localStorage.getItem('githubToken') || '';
        let owner = localStorage.getItem('githubOwner') || '';

        document.addEventListener('DOMContentLoaded', () => {
            if (token && owner) {
                document.getElementById('token').value = token;
                document.getElementById('owner').value = owner;
                showMainUI();
            }
        });

        function getHeaders() {
            return {
                'Authorization': `token ${token}`,
                'Accept': 'application/vnd.github.v3+json'
            };
        }

        async function apiCall(url, options = {}) {
            options.headers = { ...options.headers, ...getHeaders() };
            if (options.body) {
                options.headers['Content-Type'] = 'application/json';
            }
            const response = await fetch(url, options);
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(`${response.status}: ${errorData.message || response.statusText}`);
            }
            return response.json();
        }

        function showMessage(elementId, message, type) {
            const el = document.getElementById(elementId);
            el.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => el.innerHTML = '', 6000);
        }

        function setLoading(buttonId, loading) {
            const btn = document.getElementById(buttonId);
            if (loading) {
                btn.disabled = true;
                btn.innerHTML = `<div class="loading"></div>Loading...`;
                btn.setAttribute('aria-busy', 'true');
            } else {
                btn.disabled = false;
                btn.innerHTML = btn.dataset.originalText || 'Authenticate';
                btn.removeAttribute('aria-busy');
            }
        }

        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // Load saved theme
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
        });

        async function authenticate() {
            token = document.getElementById('token').value.trim();
            owner = document.getElementById('owner').value.trim();
            if (!token || !owner) {
                showMessage('authMessage', 'Please fill in all required fields.', 'error');
                return;
            }
            setLoading('authBtn', true);
            try {
                await apiCall(`${apiBase}/user`);
                localStorage.setItem('githubToken', token);
                localStorage.setItem('githubOwner', owner);
                showMessage('authMessage', 'Authenticated successfully!', 'success');
                showMainUI();
            } catch (e) {
                showMessage('authMessage', `Authentication failed: ${e.message}`, 'error');
            } finally {
                setLoading('authBtn', false);
            }
        }

        function showMainUI() {
            document.getElementById('authForm').style.display = 'none';
            document.getElementById('mainUI').style.display = 'block';
        }

        async function loadCommunities() {
            setLoading('loadCommunitiesBtn', true);
            try {
                const repos = await apiCall(`${apiBase}/users/${owner}/repos?sort=updated&direction=desc`);
                const communitiesDiv = document.getElementById('communities');
                communitiesDiv.innerHTML = '';
                if (repos.length === 0) {
                    communitiesDiv.innerHTML = '<p>No communities found. Create one to get started.</p>';
                    return;
                }
                repos.forEach(repo => {
                    const div = document.createElement('div');
                    div.className = 'community';
                    div.innerHTML = `
                        <h3>${repo.name}</h3>
                        <p>${repo.description || 'No description provided'}</p>
                        <button class="btn" onclick="loadPosts('${repo.name}')" aria-label="Load posts for ${repo.name}">Load Posts</button>
                        <button class="btn" onclick="createPost('${repo.name}')" aria-label="Create post in ${repo.name}">Create Post</button>
                        <div id="posts-${repo.name}" role="region" aria-label="Posts in ${repo.name}"></div>
                    `;
                    communitiesDiv.appendChild(div);
                });
            } catch (e) {
                showMessage('communities', `Error loading communities: ${e.message}`, 'error');
            } finally {
                setLoading('loadCommunitiesBtn', false);
            }
        }

        async function createCommunity() {
            setLoading('createCommunityBtn', true);
            const name = prompt('Enter community name (repo name):');
            if (!name) { setLoading('createCommunityBtn', false); return; }
            const description = prompt('Enter description:');
            try {
                await apiCall(`${apiBase}/user/repos`, {
                    method: 'POST',
                    body: JSON.stringify({ name, description, private: false })
                });
                showMessage('communities', 'Community created successfully!', 'success');
                loadCommunities();
            } catch (e) {
                showMessage('communities', `Error creating community: ${e.message}`, 'error');
            } finally {
                setLoading('createCommunityBtn', false);
            }
        }

        async function loadPosts(repo) {
            const postsDiv = document.getElementById(`posts-${repo}`);
            postsDiv.innerHTML = `<div class="loading" aria-hidden="true"></div>Loading posts...`;
            try {
                const issues = await apiCall(`${apiBase}/repos/${owner}/${repo}/issues?state=open&sort=updated&direction=desc`);
                postsDiv.innerHTML = '';
                if (issues.length === 0) {
                    postsDiv.innerHTML = '<p>No posts yet. Create the first one!</p>';
                    return;
                }
                issues.forEach(issue => {
                    const div = document.createElement('div');
                    div.className = 'post';
                    div.innerHTML = `
                        <h4>${issue.title}</h4>
                        <p>${issue.body ? issue.body.substring(0, 200) + (issue.body.length > 200 ? '...' : '') : 'No content'}</p>
                        <p class="post-meta">By ${issue.user.login} on ${new Date(issue.created_at).toLocaleDateString()}</p>
                        <button class="btn" onclick="loadComments('${repo}', ${issue.number})" aria-label="Load comments for post ${issue.title}">Load Comments</button>
                        <button class="btn" onclick="vote('${repo}', ${issue.number}, '+1')" aria-label="Vote up post ${issue.title}">üëç</button>
                        <button class="btn" onclick="vote('${repo}', ${issue.number}, '-1')" aria-label="Vote down post ${issue.title}">üëé</button>
                        <button class="btn" onclick="comment('${repo}', ${issue.number})" aria-label="Add comment to post ${issue.title}">Comment</button>
                        <div id="comments-${repo}-${issue.number}" role="region" aria-label="Comments for post ${issue.title}"></div>
                    `;
                    postsDiv.appendChild(div);
                });
            } catch (e) {
                postsDiv.innerHTML = `<div class="message error">Error loading posts: ${e.message}</div>`;
            }
        }

        async function createPost(repo) {
            const title = prompt('Enter post title:');
            if (!title) return;
            const body = prompt('Enter post body:');
            try {
                await apiCall(`${apiBase}/repos/${owner}/${repo}/issues`, {
                    method: 'POST',
                    body: JSON.stringify({ title, body })
                });
                showMessage(`posts-${repo}`, 'Post created successfully!', 'success');
                loadPosts(repo);
            } catch (e) {
                showMessage(`posts-${repo}`, `Error creating post: ${e.message}`, 'error');
            }
        }

        async function loadComments(repo, number) {
            const commentsDiv = document.getElementById(`comments-${repo}-${number}`);
            commentsDiv.innerHTML = `<div class="loading" aria-hidden="true"></div>Loading comments...`;
            try {
                const comments = await apiCall(`${apiBase}/repos/${owner}/${repo}/issues/${number}/comments`);
                commentsDiv.innerHTML = '';
                if (comments.length === 0) {
                    commentsDiv.innerHTML = '<p>No comments yet.</p>';
                    return;
                }
                comments.forEach(comment => {
                    const div = document.createElement('div');
                    div.className = 'comment';
                    div.innerHTML = `
                        <p>${comment.body}</p>
                        <p class="comment-meta">By ${comment.user.login} on ${new Date(comment.created_at).toLocaleDateString()}</p>
                    `;
                    commentsDiv.appendChild(div);
                });
            } catch (e) {
                commentsDiv.innerHTML = `<div class="message error">Error loading comments: ${e.message}</div>`;
            }
        }

        async function comment(repo, number) {
            const body = prompt('Enter comment:');
            if (!body) return;
            try {
                await apiCall(`${apiBase}/repos/${owner}/${repo}/issues/${number}/comments`, {
                    method: 'POST',
                    body: JSON.stringify({ body })
                });
                showMessage(`comments-${repo}-${number}`, 'Comment added successfully!', 'success');
                loadComments(repo, number);
            } catch (e) {
                showMessage(`comments-${repo}-${number}`, `Error commenting: ${e.message}`, 'error');
            }
        }

        async function vote(repo, number, reaction) {
            try {
                await apiCall(`${apiBase}/repos/${owner}/${repo}/issues/${number}/reactions`, {
                    method: 'POST',
                    body: JSON.stringify({ content: reaction })
                });
                showMessage(`posts-${repo}`, 'Vote recorded!', 'success');
            } catch (e) {
                showMessage(`posts-${repo}`, `Error voting: ${e.message}`, 'error');
            }
        }
    </script>
</body>
</html>